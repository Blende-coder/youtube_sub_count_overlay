<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Subscriber Tracker - WebSocket (EXACT COUNTS)</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      background: transparent;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: 'Poppins', sans-serif;
      overflow: hidden;
      color: white;
      user-select: none;
    }

    .container {
      position: relative;
      padding: 2.5em 5em;
      border-radius: 25px;
      background: linear-gradient(135deg, rgba(10, 25, 35, 0.9), rgba(15, 35, 50, 0.85));
      backdrop-filter: blur(10px);
      border: 2px solid rgba(0, 255, 231, 0.3);
      box-shadow:
        0 0 15px rgba(0, 255, 231, 0.5),
        0 0 30px rgba(0, 255, 231, 0.3),
        0 0 60px rgba(0, 255, 231, 0.2),
        inset 0 0 60px rgba(0, 255, 231, 0.05);
      animation: glowPulse 3s ease-in-out infinite;
      text-align: center;
      max-width: 90vw;
      width: fit-content;
      transition: transform 0.3s ease;
    }

    .container:hover {
      transform: scale(1.02);
    }

    .youtube-icon {
      width: 60px;
      height: 60px;
      margin: 0 auto 1em;
      background: linear-gradient(135deg, #FF0000, #CC0000);
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 5px 20px rgba(255, 0, 0, 0.4);
      animation: iconFloat 3s ease-in-out infinite;
    }

    .youtube-icon::before {
      content: 'â–¶';
      font-size: 2em;
      color: white;
      margin-left: 5px;
    }

    @keyframes iconFloat {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    #subCount {
      font-size: 5em;
      font-weight: 800;
      background: linear-gradient(135deg, #00ffe7, #00ffb3);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow:
        0 0 20px rgba(0, 255, 231, 0.5),
        0 0 40px rgba(0, 255, 231, 0.3);
      letter-spacing: 0.05em;
      cursor: default;
      margin: 0.2em 0;
      filter: drop-shadow(0 0 10px rgba(0, 255, 231, 0.8));
      animation: numberGlow 2s ease-in-out infinite;
    }

    @keyframes numberGlow {
      0%, 100% { 
        filter: drop-shadow(0 0 10px rgba(0, 255, 231, 0.8));
      }
      50% { 
        filter: drop-shadow(0 0 25px rgba(0, 255, 231, 1));
      }
    }

    .label {
      font-size: 1.2em;
      color: rgba(160, 240, 224, 0.8);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      margin-bottom: 0.5em;
    }

    .progress-container {
      margin: 1.5em 0;
      background: rgba(0, 255, 231, 0.1);
      border-radius: 50px;
      height: 25px;
      overflow: hidden;
      border: 1px solid rgba(0, 255, 231, 0.3);
      position: relative;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #00ffe7, #00ffb3, #00ffe7);
      background-size: 200% 100%;
      border-radius: 50px;
      transition: width 1s ease-out;
      animation: progressShine 2s linear infinite;
      box-shadow: 0 0 20px rgba(0, 255, 231, 0.6);
      position: relative;
    }

    .progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      animation: progressGloss 2s ease-in-out infinite;
    }

    @keyframes progressShine {
      0% { background-position: 0% 0%; }
      100% { background-position: 200% 0%; }
    }

    @keyframes progressGloss {
      0%, 100% { transform: translateX(-100%); }
      50% { transform: translateX(100%); }
    }

    .progress-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 0.9em;
      font-weight: 700;
      color: white;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
      z-index: 10;
    }

    #subGoal {
      font-size: 1.8em;
      margin-top: 1em;
      color: #00ffe7;
      text-shadow: 0 0 15px rgba(0, 255, 231, 0.6);
      font-weight: 700;
    }

    .goal-label {
      font-size: 0.6em;
      color: rgba(160, 240, 224, 0.7);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      display: block;
      margin-bottom: 0.3em;
    }

    @keyframes glowPulse {
      0%, 100% {
        box-shadow:
          0 0 15px rgba(0, 255, 231, 0.5),
          0 0 30px rgba(0, 255, 231, 0.3),
          0 0 60px rgba(0, 255, 231, 0.2),
          inset 0 0 60px rgba(0, 255, 231, 0.05);
      }
      50% {
        box-shadow:
          0 0 25px rgba(0, 255, 231, 0.7),
          0 0 50px rgba(0, 255, 231, 0.5),
          0 0 80px rgba(0, 255, 231, 0.3),
          inset 0 0 80px rgba(0, 255, 231, 0.08);
      }
    }

    .last-update {
      margin-top: 1em;
      font-size: 0.85em;
      color: rgba(160, 240, 224, 0.5);
      font-style: italic;
    }

    @keyframes celebrate {
      0%, 100% { transform: scale(1) rotate(0deg); }
      25% { transform: scale(1.1) rotate(-5deg); }
      75% { transform: scale(1.1) rotate(5deg); }
    }

    .celebrating {
      animation: celebrate 0.5s ease-in-out 3;
    }

    .exact-badge {
      display: inline-block;
      background: linear-gradient(135deg, #00ff88, #00cc66);
      color: #000;
      padding: 0.3em 0.8em;
      border-radius: 20px;
      font-size: 0.5em;
      font-weight: 700;
      margin-left: 0.5em;
      vertical-align: middle;
      animation: badgePulse 2s ease-in-out infinite;
    }

    @keyframes badgePulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .status-dot {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 5px;
      animation: pulse 2s ease-in-out infinite;
    }

    .status-dot.connected {
      background: #00ff88;
      box-shadow: 0 0 10px #00ff88;
    }

    .status-dot.disconnected {
      background: #ff4c4c;
      box-shadow: 0 0 10px #ff4c4c;
    }

    .status-dot.warning {
      background: #ffaa00;
      box-shadow: 0 0 10px #ffaa00;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .connection-status {
      margin-top: 1em;
      font-size: 0.9em;
      color: rgba(160, 240, 224, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(0, 255, 231, 0.3);
      border-top-color: #00ffe7;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .error-message {
      background: rgba(255, 76, 76, 0.2);
      border: 1px solid rgba(255, 76, 76, 0.5);
      border-radius: 10px;
      padding: 1em;
      margin-top: 1em;
      color: #ff4c4c;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <div class="container" id="container">
    <div class="youtube-icon"></div>
    
    <div class="label">
      Subscriber Count
      <span class="exact-badge">âš¡ EXACT â€¢ LIVE</span>
    </div>
    <div id="subCount"><span class="loading"></span></div>
    
    <div class="progress-container">
      <div class="progress-bar" id="progressBar"></div>
      <div class="progress-text" id="progressText">0%</div>
    </div>
    
    <div id="subGoal">
      <span class="goal-label">Next Milestone</span>
      <span id="goalNumber">Loading...</span>
    </div>

    <div class="last-update" id="lastUpdate"></div>
    
    <div class="connection-status">
      <span class="status-dot disconnected" id="statusDot"></span>
      <span id="statusText">Connecting...</span>
    </div>

    <div id="errorMsg" class="error-message" style="display: none;"></div>
  </div>

  <!-- Socket.IO Client Library -->
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  
  <script>
    // ==================== CONFIGURATION ====================
    // IMPORTANT: Replace with your WebSocket server URL
    // Local: 'http://localhost:3000'
    // Production: 'https://your-app.railway.app' or your deployed URL
    const WEBSOCKET_URL = 'http://localhost:3000';
    
    const subCountEl = document.getElementById('subCount');
    const subGoalEl = document.getElementById('goalNumber');
    const progressBarEl = document.getElementById('progressBar');
    const progressTextEl = document.getElementById('progressText');
    const lastUpdateEl = document.getElementById('lastUpdate');
    const containerEl = document.getElementById('container');
    const statusDotEl = document.getElementById('statusDot');
    const statusTextEl = document.getElementById('statusText');
    const errorMsgEl = document.getElementById('errorMsg');

    let currentCount = 0;
    let lastMilestone = 0;
    let goal = 810;
    let previousGoal = 800;

    // ==================== WEBSOCKET CONNECTION ====================
    const socket = io(WEBSOCKET_URL, {
      reconnection: true,
      reconnectionDelay: 1000,
      reconnectionAttempts: Infinity,
      timeout: 10000
    });

    // Connection established
    socket.on('connect', () => {
      console.log('âœ… Connected to WebSocket server');
      statusDotEl.className = 'status-dot connected';
      statusTextEl.textContent = 'Connected - Live Updates (Exact Counts)';
      errorMsgEl.style.display = 'none';
    });

    // Connection lost
    socket.on('disconnect', () => {
      console.log('âŒ Disconnected from WebSocket server');
      statusDotEl.className = 'status-dot disconnected';
      statusTextEl.textContent = 'Disconnected - Reconnecting...';
    });

    // Reconnecting
    socket.on('reconnect_attempt', () => {
      console.log('ðŸ”„ Attempting to reconnect...');
      statusDotEl.className = 'status-dot warning';
      statusTextEl.textContent = 'Reconnecting...';
    });

    // Reconnected
    socket.on('reconnect', () => {
      console.log('âœ… Reconnected successfully!');
      statusDotEl.className = 'status-dot connected';
      statusTextEl.textContent = 'Reconnected - Live Updates';
      errorMsgEl.style.display = 'none';
    });

    // Receive subscriber updates (EXACT COUNTS!)
    socket.on('subscriber-update', (data) => {
      console.log('ðŸ“Š Exact count received:', data);
      
      goal = data.goal;
      previousGoal = data.previousGoal;
      
      animateCount(data.count);
      subGoalEl.textContent = goal.toLocaleString();
      
      const updateTime = new Date(data.timestamp).toLocaleTimeString('en-US', {
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      });
      lastUpdateEl.textContent = `Last update: ${updateTime} ${data.exact ? '(Exact)' : ''}`;
      
      errorMsgEl.style.display = 'none';
    });

    // Handle errors
    socket.on('error', (error) => {
      console.error('âš ï¸ WebSocket error:', error);
      errorMsgEl.textContent = error.message || 'Connection error';
      errorMsgEl.style.display = 'block';
      
      if (error.message && error.message.includes('not authenticated')) {
        statusDotEl.className = 'status-dot warning';
        statusTextEl.textContent = 'Server needs authentication';
      }
    });

    // Connection error
    socket.on('connect_error', (error) => {
      console.error('âŒ Connection error:', error.message);
      errorMsgEl.textContent = `Cannot connect to server at ${WEBSOCKET_URL}. Make sure the server is running.`;
      errorMsgEl.style.display = 'block';
    });

    // ==================== ANIMATION FUNCTIONS ====================
    function animateCount(newCount) {
      const duration = 1500;
      const frameRate = 60;
      const totalFrames = Math.round(duration / (1000 / frameRate));
      let frame = 0;
      const startCount = currentCount;

      const counter = setInterval(() => {
        frame++;
        const progress = frame / totalFrames;
        const easeProgress = easeOutCubic(progress);
        const countToShow = Math.floor(startCount + (newCount - startCount) * easeProgress);

        subCountEl.textContent = countToShow.toLocaleString();

        if (frame === totalFrames) {
          clearInterval(counter);
          currentCount = newCount;
          updateProgress();
        }
      }, 1000 / frameRate);
    }

    function easeOutCubic(t) {
      return 1 - Math.pow(1 - t, 3);
    }

    function updateProgress() {
      const progressFromPrevious = currentCount - previousGoal;
      const totalRange = goal - previousGoal;
      const percentage = Math.min(100, Math.max(0, (progressFromPrevious / totalRange) * 100));
      
      progressBarEl.style.width = `${percentage}%`;
      progressTextEl.textContent = `${Math.round(percentage)}%`;

      if (currentCount >= goal && currentCount !== lastMilestone) {
        celebrateMilestone();
        lastMilestone = currentCount;
      }
    }

    function celebrateMilestone() {
      containerEl.classList.add('celebrating');
      setTimeout(() => {
        containerEl.classList.remove('celebrating');
      }, 1500);
    }

    // Manual refresh (optional - can be triggered externally)
    function requestUpdate() {
      socket.emit('request-update');
      console.log('ðŸ“¡ Requested manual update');
    }

    // Make requestUpdate available globally for debugging
    window.requestUpdate = requestUpdate;
  </script>
</body>
</html>
